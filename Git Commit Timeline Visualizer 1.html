<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Git Timeline Visualizer Pro</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.8rem;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .control-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .input-section {
            margin-bottom: 20px;
        }

        .input-section h3 {
            margin-bottom: 10px;
            color: #4a5568;
            font-weight: 600;
        }

        .commit-input {
            width: 100%;
            height: 120px;
            padding: 15px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            resize: vertical;
            transition: all 0.3s ease;
        }

        .commit-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .control-group {
            display: flex;
            flex-direction: column;
        }

        .control-group label {
            font-weight: 600;
            margin-bottom: 5px;
            color: #4a5568;
        }

        select, input[type="range"] {
            padding: 8px 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        select:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .stats-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            backdrop-filter: blur(5px);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #6b7280;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .visualization-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            min-height: 400px;
        }

        .timeline {
            position: relative;
            margin: 20px 0;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            width: 4px;
            height: 100%;
            background: linear-gradient(to bottom, #667eea, #764ba2);
            border-radius: 2px;
        }

        .commit-item {
            position: relative;
            margin: 30px 0;
            padding: 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .commit-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(0,0,0,0.15);
        }

        .commit-item.left {
            margin-right: 52%;
            text-align: right;
        }

        .commit-item.right {
            margin-left: 52%;
            text-align: left;
        }

        .commit-item::before {
            content: '';
            position: absolute;
            top: 20px;
            width: 16px;
            height: 16px;
            background: #667eea;
            border: 4px solid white;
            border-radius: 50%;
            box-shadow: 0 0 0 4px #667eea;
        }

        .commit-item.left::before {
            right: -40px;
        }

        .commit-item.right::before {
            left: -40px;
        }

        .commit-hash {
            font-family: 'Courier New', monospace;
            color: #667eea;
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 8px;
        }

        .commit-message {
            font-size: 1.1rem;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 8px;
            line-height: 1.4;
        }

        .commit-author {
            color: #6b7280;
            font-size: 0.9rem;
            margin-bottom: 5px;
        }

        .commit-date {
            color: #9ca3af;
            font-size: 0.85rem;
        }

        .chart-view {
            display: none;
        }

        .chart-view.active {
            display: block;
        }

        .chart-container {
            width: 100%;
            height: 400px;
            position: relative;
            margin: 20px 0;
        }

        .bar-chart {
            display: flex;
            align-items: end;
            height: 300px;
            padding: 20px;
            gap: 10px;
        }

        .bar {
            background: linear-gradient(to top, #667eea, #764ba2);
            border-radius: 4px 4px 0 0;
            min-width: 30px;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }

        .bar:hover {
            filter: brightness(1.2);
            transform: scale(1.05);
        }

        .bar-label {
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.8rem;
            color: #6b7280;
            white-space: nowrap;
        }

        .heatmap {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 3px;
            max-width: 600px;
            margin: 20px auto;
        }

        .heatmap-day {
            aspect-ratio: 1;
            border-radius: 3px;
            background: #f3f4f6;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }

        .heatmap-day.level-1 { background: #c6e48b; }
        .heatmap-day.level-2 { background: #7bc96f; }
        .heatmap-day.level-3 { background: #239a3b; }
        .heatmap-day.level-4 { background: #196127; }

        .heatmap-day:hover {
            transform: scale(1.2);
            z-index: 10;
        }

        .filter-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }

        .filter-tag {
            background: #f3f4f6;
            color: #4b5563;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .filter-tag.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .filter-tag:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .export-options {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .search-box {
            width: 100%;
            padding: 10px 40px 10px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 25px;
            font-size: 14px;
            margin-bottom: 20px;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="%23999" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="21 21l-4.35-4.35"/></svg>') no-repeat right 15px center;
        }

        .tooltip {
            position: absolute;
            background: #2d3748;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.85rem;
            pointer-events: none;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .tooltip.show {
            opacity: 1;
        }

        @media (max-width: 768px) {
            .commit-item.left,
            .commit-item.right {
                margin-left: 30px;
                margin-right: 0;
                text-align: left;
            }

            .commit-item::before {
                left: -20px !important;
                right: auto !important;
            }

            .timeline::before {
                left: 20px;
            }

            .controls {
                grid-template-columns: 1fr;
            }
        }

        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f4f6;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .fade-in {
            animation: fadeIn 0.6s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Git Timeline Visualizer Pro</h1>
            <p>Advanced commit analysis and visualization platform</p>
        </div>

        <div class="control-panel">
            <div class="input-section">
                <h3>Paste Git Log Data</h3>
                <textarea class="commit-input" placeholder="Paste your git log output here. Supported formats:
• git log --oneline
• git log --pretty=format:'%h|%an|%ad|%s' --date=short
• Standard git log output

Example:
a1b2c3d Fix authentication bug
e4f5g6h Add user dashboard
i7j8k9l Update documentation"></textarea>
            </div>

            <div class="controls">
                <div class="control-group">
                    <label>View Mode</label>
                    <select id="viewMode">
                        <option value="timeline">Timeline View</option>
                        <option value="chart">Activity Chart</option>
                        <option value="heatmap">Commit Heatmap</option>
                        <option value="stats">Statistics View</option>
                    </select>
                </div>

                <div class="control-group">
                    <label>Time Range</label>
                    <select id="timeRange">
                        <option value="all">All Time</option>
                        <option value="week">Last Week</option>
                        <option value="month">Last Month</option>
                        <option value="quarter">Last Quarter</option>
                        <option value="year">Last Year</option>
                    </select>
                </div>

                <div class="control-group">
                    <label>Animation Speed</label>
                    <input type="range" id="animationSpeed" min="0.5" max="3" step="0.5" value="1">
                </div>

                <div class="control-group">
                    <button class="btn" onclick="parseAndVisualize()">Visualize Commits</button>
                </div>
            </div>

            <input type="text" class="search-box" placeholder="Search commits, authors, or messages..." id="searchBox">

            <div class="filter-tags" id="filterTags">
                <div class="filter-tag active" data-filter="all">All Commits</div>
                <div class="filter-tag" data-filter="feature">Features</div>
                <div class="filter-tag" data-filter="fix">Bug Fixes</div>
                <div class="filter-tag" data-filter="docs">Documentation</div>
                <div class="filter-tag" data-filter="refactor">Refactoring</div>
            </div>
        </div>

        <div class="stats-panel" id="statsPanel">
            <div class="stat-card">
                <div class="stat-number" id="totalCommits">0</div>
                <div class="stat-label">Total Commits</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalAuthors">0</div>
                <div class="stat-label">Contributors</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="avgPerDay">0</div>
                <div class="stat-label">Avg/Day</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="mostActiveDay">-</div>
                <div class="stat-label">Most Active Day</div>
            </div>
        </div>

        <div class="visualization-container">
            <div id="timelineView" class="timeline-view">
                <div class="timeline" id="timeline"></div>
            </div>

            <div id="chartView" class="chart-view">
                <div class="chart-container">
                    <div class="bar-chart" id="barChart"></div>
                </div>
            </div>

            <div id="heatmapView" class="chart-view">
                <h3 style="text-align: center; margin-bottom: 20px;">Commit Activity Heatmap</h3>
                <div class="heatmap" id="heatmap"></div>
            </div>

            <div class="export-options">
                <button class="btn" onclick="exportData('json')">Export JSON</button>
                <button class="btn" onclick="exportData('csv')">Export CSV</button>
                <button class="btn" onclick="exportImage()">Export Image</button>
            </div>
        </div>
    </div>

    <div class="tooltip" id="tooltip"></div>

    <script>
        let commits = [];
        let filteredCommits = [];
        let currentView = 'timeline';

        // Sample data for demonstration
        const sampleData = `a1b2c3d|John Doe|2024-01-15|feat: Add user authentication system
e4f5g6h|Jane Smith|2024-01-14|fix: Resolve memory leak in data processing
i7j8k9l|Mike Johnson|2024-01-13|docs: Update API documentation
m8n9o0p|John Doe|2024-01-12|refactor: Optimize database queries
q1r2s3t|Jane Smith|2024-01-11|feat: Implement real-time notifications
u4v5w6x|Alex Brown|2024-01-10|fix: Handle edge case in user input validation
y7z8a9b|Mike Johnson|2024-01-09|feat: Add dark mode support
c0d1e2f|John Doe|2024-01-08|test: Add unit tests for auth module
g3h4i5j|Jane Smith|2024-01-07|fix: Correct timezone handling
k6l7m8n|Alex Brown|2024-01-06|docs: Add installation guide`;

        // Initialize with sample data
        document.querySelector('.commit-input').value = sampleData;

        function parseGitLog(input) {
            const lines = input.trim().split('\n').filter(line => line.trim());
            const parsedCommits = [];

            lines.forEach((line, index) => {
                let hash, author, date, message;

                // Try different formats
                if (line.includes('|')) {
                    // Format: hash|author|date|message
                    const parts = line.split('|');
                    if (parts.length >= 4) {
                        [hash, author, date, message] = parts;
                    }
                } else if (line.match(/^[a-f0-9]{6,40}\s/)) {
                    // Format: hash message (git log --oneline)
                    const match = line.match(/^([a-f0-9]+)\s(.+)$/);
                    if (match) {
                        hash = match[1];
                        message = match[2];
                        author = 'Unknown';
                        date = new Date().toISOString().split('T')[0];
                    }
                } else {
                    // Fallback: treat as message with generated data
                    hash = generateHash();
                    message = line;
                    author = 'Unknown';
                    date = new Date(Date.now() - index * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
                }

                if (hash && message) {
                    parsedCommits.push({
                        hash: hash.trim(),
                        author: author.trim(),
                        date: date.trim(),
                        message: message.trim(),
                        timestamp: new Date(date).getTime()
                    });
                }
            });

            return parsedCommits.sort((a, b) => b.timestamp - a.timestamp);
        }

        function generateHash() {
            return Math.random().toString(16).substr(2, 7);
        }

        function categorizeCommit(message) {
            const msg = message.toLowerCase();
            if (msg.includes('feat') || msg.includes('feature') || msg.includes('add')) return 'feature';
            if (msg.includes('fix') || msg.includes('bug') || msg.includes('resolve')) return 'fix';
            if (msg.includes('doc') || msg.includes('readme')) return 'docs';
            if (msg.includes('refactor') || msg.includes('optimize')) return 'refactor';
            return 'other';
        }

        function updateStats() {
            const totalCommits = filteredCommits.length;
            const authors = [...new Set(filteredCommits.map(c => c.author))];
            
            const daySpan = totalCommits > 0 ? 
                (Math.max(...filteredCommits.map(c => c.timestamp)) - 
                 Math.min(...filteredCommits.map(c => c.timestamp))) / (1000 * 60 * 60 * 24) + 1 : 1;
            
            const avgPerDay = totalCommits > 0 ? (totalCommits / daySpan).toFixed(1) : 0;
            
            const dayCount = {};
            filteredCommits.forEach(commit => {
                const day = new Date(commit.timestamp).toLocaleDateString('en-US', { weekday: 'long' });
                dayCount[day] = (dayCount[day] || 0) + 1;
            });
            
            const mostActiveDay = Object.keys(dayCount).reduce((a, b) => 
                dayCount[a] > dayCount[b] ? a : b, 'None');

            document.getElementById('totalCommits').textContent = totalCommits;
            document.getElementById('totalAuthors').textContent = authors.length;
            document.getElementById('avgPerDay').textContent = avgPerDay;
            document.getElementById('mostActiveDay').textContent = mostActiveDay;
        }

        function renderTimeline() {
            const timeline = document.getElementById('timeline');
            timeline.innerHTML = '';

            filteredCommits.forEach((commit, index) => {
                const item = document.createElement('div');
                item.className = `commit-item ${index % 2 === 0 ? 'left' : 'right'} fade-in`;
                item.style.animationDelay = `${index * 0.1}s`;
                
                const category = categorizeCommit(commit.message);
                const categoryColor = {
                    feature: '#10b981',
                    fix: '#ef4444',
                    docs: '#3b82f6',
                    refactor: '#f59e0b',
                    other: '#6b7280'
                }[category];

                item.innerHTML = `
                    <div class="commit-hash">${commit.hash}</div>
                    <div class="commit-message">${commit.message}</div>
                    <div class="commit-author">👤 ${commit.author}</div>
                    <div class="commit-date">📅 ${new Date(commit.date).toLocaleDateString()}</div>
                `;

                item.style.borderLeft = `4px solid ${categoryColor}`;
                
                item.addEventListener('click', () => showCommitDetails(commit));
                timeline.appendChild(item);
            });
        }

        function renderChart() {
            const chart = document.getElementById('barChart');
            chart.innerHTML = '';

            const dailyCommits = {};
            filteredCommits.forEach(commit => {
                const date = commit.date;
                dailyCommits[date] = (dailyCommits[date] || 0) + 1;
            });

            const maxCommits = Math.max(...Object.values(dailyCommits));
            const entries = Object.entries(dailyCommits).sort();

            entries.forEach(([date, count]) => {
                const bar = document.createElement('div');
                bar.className = 'bar';
                bar.style.height = `${(count / maxCommits) * 250}px`;
                bar.innerHTML = `<div class="bar-label">${new Date(date).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}</div>`;
                
                bar.addEventListener('mouseenter', (e) => showTooltip(e, `${count} commits on ${date}`));
                bar.addEventListener('mouseleave', hideTooltip);
                
                chart.appendChild(bar);
            });
        }

        function renderHeatmap() {
            const heatmap = document.getElementById('heatmap');
            heatmap.innerHTML = '';

            const dailyCommits = {};
            filteredCommits.forEach(commit => {
                const date = commit.date;
                dailyCommits[date] = (dailyCommits[date] || 0) + 1;
            });

            const maxCommits = Math.max(...Object.values(dailyCommits), 1);
            
            // Generate last 49 days (7x7 grid)
            for (let i = 48; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                const dateStr = date.toISOString().split('T')[0];
                
                const commits = dailyCommits[dateStr] || 0;
                const level = commits === 0 ? 0 : Math.ceil((commits / maxCommits) * 4);
                
                const day = document.createElement('div');
                day.className = `heatmap-day ${level > 0 ? `level-${level}` : ''}`;
                
                day.addEventListener('mouseenter', (e) => 
                    showTooltip(e, `${commits} commits on ${date.toLocaleDateString()}`));
                day.addEventListener('mouseleave', hideTooltip);
                
                heatmap.appendChild(day);
            }
        }

        function showTooltip(event, text) {
            const tooltip = document.getElementById('tooltip');
            tooltip.textContent = text;
            tooltip.style.left = event.pageX + 10 + 'px';
            tooltip.style.top = event.pageY - 10 + 'px';
            tooltip.classList.add('show');
        }

        function hideTooltip() {
            document.getElementById('tooltip').classList.remove('show');
        }

        function showCommitDetails(commit) {
            alert(`Commit Details:\n\nHash: ${commit.hash}\nAuthor: ${commit.author}\nDate: ${commit.date}\nMessage: ${commit.message}`);
        }

        function switchView(view) {
            document.querySelectorAll('.timeline-view, .chart-view').forEach(el => {
                el.style.display = 'none';
                el.classList.remove('active');
            });

            switch(view) {
                case 'timeline':
                    document.getElementById('timelineView').style.display = 'block';
                    renderTimeline();
                    break;
                case 'chart':
                    document.getElementById('chartView').style.display = 'block';
                    document.getElementById('chartView').classList.add('active');
                    renderChart();
                    break;
                case 'heatmap':
                    document.getElementById('heatmapView').style.display = 'block';
                    document.getElementById('heatmapView').classList.add('active');
                    renderHeatmap();
                    break;
            }
        }

        function applyFilters() {
            const searchTerm = document.getElementById('searchBox').value.toLowerCase();
            const activeFilter = document.querySelector('.filter-tag.active').dataset.filter;
            const timeRange = document.getElementById('timeRange').value;

            let filtered = commits.filter(commit => {
                const matchesSearch = commit.message.toLowerCase().includes(searchTerm) ||
                                    commit.author.toLowerCase().includes(searchTerm) ||
                                    commit.hash.toLowerCase().includes(searchTerm);

                const matchesCategory = activeFilter === 'all' || 
                                      categorizeCommit(commit.message) === activeFilter;

                let matchesTime = true;
                if (timeRange !== 'all') {
                    const now = Date.now();
                    const ranges = {
                        week: 7 * 24 * 60 * 60 * 1000,
                        month: 30 * 24 * 60 * 60 * 1000,
                        quarter: 90 * 24 * 60 * 60 * 1000,
                        year: 365 * 24 * 60 * 60 * 1000
                    };
                    matchesTime = (now - commit.timestamp) <= ranges[timeRange];
                }

                return matchesSearch && matchesCategory && matchesTime;
            });

            filteredCommits = filtered;
            updateStats();
            switchView(currentView);
        }

        function parseAndVisualize() {
            const input = document.querySelector('.commit-input').value;
            if (!input.trim()) {
                alert('Please paste some git log data first!');
                return;
            }

            commits = parseGitLog(input);
            filteredCommits = commits;
            
            if (commits.length === 0) {
                alert('No valid commits found. Please check your input format.');
                return;
            }

            updateStats();
            switchView(currentView);
        }

        function exportData(format) {
            if (filteredCommits.length === 0) {
                alert('No data to export. Please visualize some commits first.');
                return;
            }

            let content, filename, mimeType;

            if (format === 'json') {
                content = JSON.stringify(filteredCommits, null, 2);
                filename = 'commits.json';
                mimeType = 'application/json';
            } else if (format === 'csv') {
                const headers = 'Hash,Author,Date,Message\n';
                const rows = filteredCommits.map(c => 
                    `"${c.hash}","${c.author}","${c.date}","${c.message.replace(/"/g, '""')}"`
                ).join('\n');
                content = headers + rows;
                filename = 'commits.csv';
                mimeType = 'text/csv';
            }

            const blob = new Blob([content], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
        }

        function exportImage() {
            // Create a canvas for image export
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = 1200;
            canvas.height = 800;

            // Fill background
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Add title
            ctx.fillStyle = '#333333';
            ctx.font = 'bold 24px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('Git Commit Timeline', canvas.width / 2, 40);

            // Simple visualization
            ctx.font = '14px Arial';
            ctx.textAlign = 'left';
            filteredCommits.slice(0, 15).forEach((commit, index) => {
                const y = 80 + index * 45;
                
                // Draw commit dot
                ctx.fillStyle = '#667eea';
                ctx.beginPath();
                ctx.arc(50, y, 8, 0, 2 * Math.PI);
                ctx.fill();

                // Draw commit info
                ctx.fillStyle = '#333333';
                ctx.fillText(`${commit.hash} - ${commit.message}`, 80, y);
                ctx.fillStyle = '#666666';
                ctx.font = '12px Arial';
                ctx.fillText(`${commit.author} • ${commit.date}`, 80, y + 16);
                ctx.font = '14px Arial';
            });

            // Download the image
            canvas.toBlob(blob => {
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'git-timeline.png';
                a.click();
                URL.revokeObjectURL(url);
            });
        }

        // Event listeners
        document.getElementById('viewMode').addEventListener('change', (e) => {
            currentView = e.target.value;
            switchView(currentView);
        });

        document.getElementById('searchBox').addEventListener('input', applyFilters);
        document.getElementById('timeRange').addEventListener('change', applyFilters);

        document.querySelectorAll('.filter-tag').forEach(tag => {
            tag.addEventListener('click', () => {
                document.querySelectorAll('.filter-tag').forEach(t => t.classList.remove('active'));
                tag.classList.add('active');
                applyFilters();
            });
        });

        // Advanced features
        function generateInsights() {
            if (commits.length === 0) return;

            const insights = [];
            
            // Most active author
            const authorCounts = {};
            commits.forEach(c => authorCounts[c.author] = (authorCounts[c.author] || 0) + 1);
            const topAuthor = Object.entries(authorCounts).sort((a, b) => b[1] - a[1])[0];
            insights.push(`${topAuthor[0]} is the most active contributor with ${topAuthor[1]} commits`);

            // Most common commit types
            const typeCounts = {};
            commits.forEach(c => {
                const type = categorizeCommit(c.message);
                typeCounts[type] = (typeCounts[type] || 0) + 1;
            });
            const topType = Object.entries(typeCounts).sort((a, b) => b[1] - a[1])[0];
            insights.push(`Most commits are ${topType[0]} related (${topType[1]} commits)`);

            // Activity patterns
            const hourCounts = {};
            commits.forEach(c => {
                const hour = new Date(c.timestamp).getHours();
                hourCounts[hour] = (hourCounts[hour] || 0) + 1;
            });
            const peakHour = Object.entries(hourCounts).sort((a, b) => b[1] - a[1])[0];
            if (peakHour) {
                insights.push(`Peak development time is around ${peakHour[0]}:00`);
            }

            return insights;
        }

        function showInsights() {
            const insights = generateInsights();
            if (insights.length > 0) {
                alert('Project Insights:\n\n' + insights.join('\n\n'));
            }
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case '1':
                        e.preventDefault();
                        document.getElementById('viewMode').value = 'timeline';
                        currentView = 'timeline';
                        switchView(currentView);
                        break;
                    case '2':
                        e.preventDefault();
                        document.getElementById('viewMode').value = 'chart';
                        currentView = 'chart';
                        switchView(currentView);
                        break;
                    case '3':
                        e.preventDefault();
                        document.getElementById('viewMode').value = 'heatmap';
                        currentView = 'heatmap';
                        switchView(currentView);
                        break;
                    case 'Enter':
                        e.preventDefault();
                        parseAndVisualize();
                        break;
                }
            }
        });

        // Animation speed control
        document.getElementById('animationSpeed').addEventListener('input', (e) => {
            const speed = e.target.value;
            document.documentElement.style.setProperty('--animation-speed', `${1/speed}s`);
        });

        // Dark mode toggle
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
        }

        // Add dark mode styles
        const darkModeStyles = `
            .dark-mode {
                background: linear-gradient(135deg, #1a202c 0%, #2d3748 100%);
                color: #e2e8f0;
            }
            .dark-mode .control-panel,
            .dark-mode .visualization-container {
                background: rgba(45, 55, 72, 0.95);
                color: #e2e8f0;
            }
            .dark-mode .commit-item {
                background: #2d3748;
                color: #e2e8f0;
            }
            .dark-mode .stat-card {
                background: rgba(45, 55, 72, 0.9);
                color: #e2e8f0;
            }
        `;

        const styleSheet = document.createElement('style');
        styleSheet.textContent = darkModeStyles;
        document.head.appendChild(styleSheet);

        // Initialize with sample data visualization
        setTimeout(() => {
            parseAndVisualize();
        }, 100);

        // Performance monitoring
        function measurePerformance(func, name) {
            const start = performance.now();
            func();
            const end = performance.now();
            console.log(`${name} took ${(end - start).toFixed(2)}ms`);
        }

        // Add smooth scrolling for better UX
        function smoothScrollTo(element) {
            element.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        // Enhanced error handling
        window.addEventListener('error', (e) => {
            console.error('Application error:', e.error);
            // Could integrate with error reporting service in production
        });

        // Progressive enhancement features
        if ('serviceWorker' in navigator) {
            // Could register service worker for offline capability
        }

        // Accessibility improvements
        document.addEventListener('DOMContentLoaded', () => {
            // Add ARIA labels and roles where needed
            document.getElementById('timeline').setAttribute('role', 'log');
            document.getElementById('timeline').setAttribute('aria-label', 'Git commit timeline');
            
            // Add keyboard navigation
            document.querySelectorAll('.commit-item').forEach((item, index) => {
                item.setAttribute('tabindex', '0');
                item.setAttribute('role', 'button');
                item.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        item.click();
                    }
                });
            });
        });

        // Add context menu for advanced options
        document.addEventListener('contextmenu', (e) => {
            if (e.target.closest('.commit-item')) {
                e.preventDefault();
                // Could show context menu with options like "Copy hash", "View diff", etc.
            }
        });
    </script>
</body>
</html>